name: Use Transformational Products With Token Licensing on GitHub-Hosted Runner
on: [push]
env:
  MLM_LICENSE_TOKEN: ${{ secrets.MLM_LICENSE_TOKEN }}
jobs:
  build-app:
    name: Build Standalone Application
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository
        uses: actions/checkout@v4
      - name: Set up MATLAB
        uses: matlab-actions/setup-matlab@v2
        with:
          products: MATLAB_Compiler
          cache: true
      - name: Run script
        uses: matlab-actions/run-command@v2
        with:
          command: compiler.build.standaloneApplication("hello.m");
      - name: Upload built application
        uses: actions/upload-artifact@v4
        with:
          name: hellostandaloneApplication
          path: hellostandaloneApplication
  test-app:
    name: Test Standalone Application
    needs: build-app
    runs-on: ubuntu-latest
    container:
      image: containers.mathworks.com/matlab-runtime:r2023b
    steps:
      - uses: actions/download-artifact@v4
        with:
          name: hellostandaloneApplication
          path: hellostandaloneApplication
      - name: Test running standalone app
        run: |
          chmod +x ./hellostandaloneApplication/run_hello.sh
          ./hellostandaloneApplication/run_hello.sh /opt/matlabruntime/R2023b
